{% extends "layout.html" %}

{% block title %}Home | Online Bookstore{% endblock %}

{% block content %}
<!-- dashboard heading and stats -->
<div class="row mb-5">
    <div class="col-md-8">
        <h1 class="fw-bold text-dark">Dashboard Overview</h1>
        <p class="text-muted">Welcome to the internal inventory management system.</p>
    </div>
    <div class="col-md-4 text-md-end">
        <a href="{{ url_for('add_book') }}" class="btn btn-primary px-4"><i class="fa fa-plus me-2"></i>Add Stock</a>
    </div>
</div>

<div class="row g-4 mb-5">
    <!-- Total Books Card -->
    <div class="col-6 col-md-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-3 text-center">
                <div class="mb-2 text-primary opacity-75">
                    <i class="fa fa-book fa-2x"></i>
                </div>
                <h6 class="text-muted text-uppercase mb-1 text-primary"
                    style="font-size: 0.7rem; letter-spacing: 0.5px;">Total Inventory</h6>
                <h3 class="fw-bold mb-0 text-dark">{{ total_books }}</h3>
            </div>
        </div>
    </div>

    <!-- Low Stock Card -->
    <div class="col-6 col-md-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-3 text-center">
                <div class="mb-2 {% if low_stock_count > 0 %}text-danger{% else %}text-success{% endif %} opacity-75">
                    <i class="fa fa-exclamation-triangle fa-2x"></i>
                </div>
                <h6 class="text-muted text-uppercase mb-1" style="font-size: 0.7rem; letter-spacing: 0.5px;">Low Stock
                    Alerts</h6>
                <h3 class="fw-bold mb-0 {% if low_stock_count > 0 %}text-danger{% else %}text-success{% endif %}">{{
                    low_stock_count }}</h3>
            </div>
        </div>
    </div>

    <!-- Today's Sales Card -->
    <div class="col-12 col-md-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-3 text-center">
                <div class="mb-2 text-success opacity-75">
                    <i class="fa fa-bar-chart fa-2x"></i>
                </div>
                <h6 class="text-muted text-uppercase mb-1" style="font-size: 0.7rem; letter-spacing: 0.5px;">Today's
                    Revenue</h6>
                <h3 class="fw-bold mb-0 text-success">KES {{ "{:,.0f}".format(today_sales) }}</h3>
            </div>
        </div>
    </div>
</div>

<!-- Main Content Area -->
<div class="container mb-5" id="featured">
    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
        <h3 class="fw-bold mb-0 text-dark">Latest Additions</h3>
        <a href="{{ url_for('inventory') }}" class="btn btn-dark px-4 shadow-sm">View Full Inventory</a>
    </div>

    {% if latest_books %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
        {% for book in latest_books %}
        <div class="col">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 p-0 position-relative">
                    {% if book.stock_quantity > 0 %}
                    <span class="badge bg-success position-absolute top-0 end-0 m-3 shadow-sm rounded-1">In Stock</span>
                    {% else %}
                    <span class="badge bg-danger position-absolute top-0 end-0 m-3 shadow-sm rounded-1">Sold Out</span>
                    {% endif %}
                    <div class="img-wrapper d-flex align-items-center justify-content-center bg-light rounded-top"
                        style="height: 260px;">
                        <img src="{{ url_for('static', filename=book.image_url) }}" class="img-fluid"
                            alt="{{ book.title }}" style="max-height: 220px; max-width: 100%; object-fit: contain;">
                    </div>
                </div>
                <div class="card-body d-flex flex-column p-4">
                    <div class="mb-2">
                        <small class="text-uppercase text-muted fw-bold"
                            style="font-size: 0.75rem; letter-spacing: 1px;">{{ book.category }}</small>
                    </div>
                    <h5 class="card-title fw-bold text-dark mb-1 text-truncate" title="{{ book.title }}">{{ book.title
                        }}</h5>
                    <p class="card-text text-secondary mb-3 small">{{ book.author }}</p>

                    <div class="mt-auto pt-3 border-top d-flex justify-content-between align-items-center">
                        <div class="me-2">
                            <span class="d-block text-muted small">Price</span>
                            <span class="fw-bold text-dark fs-5 text-nowrap">KES {{ "{:,.0f}".format(book.price)
                                }}</span>
                        </div>
                        <form action="{{ url_for('sell_book', book_id=book.id) }}" method="POST">
                            <button type="submit" class="btn btn-dark px-4 shadow-sm text-nowrap" {% if
                                book.stock_quantity==0 %}disabled{% endif %}>
                                <i class="fa fa-shopping-bag me-1"></i> Sell
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
        <div class="display-1 text-muted opacity-25 mb-3"><i class="fa fa-book"></i></div>
        <h4 class="text-muted">No books available in the inventory.</h4>
        <p class="text-muted mb-4 opacity-75">Start managing your bookstore by adding new stock.</p>
        <a href="{{ url_for('add_book') }}" class="btn btn-primary px-4">Add First Book</a>
    </div>
    {% endif %}
</div>
{% endblock %}